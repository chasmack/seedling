{% extends 'base.html' %}

{%- block title %}Seedling Control{% endblock title %}
{%- block styles %}
{{- super() }}
<style>
h1.chan-name {color:#1e88e5;}
</style>
{%- endblock styles -%}

<!--{%- block navigation %}-->
<!-- begin navigation controls block -->
        <ul class="nav navbar-nav navbar-right">
          <li>
            <form class="navbar-form" role="search" action="{{ url_for('seedling') }}" method="get">
              <div class="form-group">
                <div class="input-group">
                  <span class="input-group-btn">
                    <button class="btn btn-secondary" type="submit">
                      <span class="glyphicon glyphicon-share-alt"></span>
                    </button>
                  </span>
                  <input class="form-control" type="text" name="msg" value="" placeholder="send message" autofocus autocomplete="off">
                </div>
              </div>
            </form>
          </li>
          <li><a href="https://github.com/chasmack/seedling" target="_blank">about</a></li>
        </ul>
<!-- end navigation controls -->
{%- endblock navigation -%}

{% block page %}
<!-- begin page content block -->
    <div id="chan-table">
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Temp</th>
            <th>Set</th>
            <th>On/Off</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>

<!-- end page content block -->
{%- endblock page -%}

{% block scripts %}
<!-- begin scripts block -->
    {{- super() }}
    <script src="{{ url_for('static', filename='js/jquery.mousewheel.js') }}"></script>
    <script src="{{ url_for('static', filename='js/seedling.js') }}"></script>
    <script>

function update_chans() {
  $.get('/stat', function(data) {
    console.log(data);
    $tbody = $('#chan-table tbody').empty()
    data.chans.forEach(function(chan) {
      var row = '';
      if (chan.enabled === null) {
        row += '<tr>\n';
        row += '<th scope="row">' + chan.name + '</th>\n';
        row += '<td>' + chan.temp.toFixed(1) + '&deg;</td>\n';
        row += '<td></td>\n';
        row += '<td></td>\n';
        row += '</tr>\n';

      } else if (chan.enabled) {
        row += '<tr class="success">\n';
        row += '<th scope="row">' + chan.name + '</th>\n';
        row += '<td>' + chan.temp.toFixed(1) + '&deg;</td>\n';
        row += '<td>' + chan.set.toFixed(0) + '&deg;</td>\n';
        row += '<td>' + (chan.relay ? 'ON' : 'OFF') + '</td>\n';
        row += '</tr>\n';

      } else {
        row += '<tr>\n';
        row += '<th scope="row">' + chan.name + '</th>\n';
        row += '<td>' + chan.temp.toFixed(1) + '&deg;</td>\n';
        row += '<td>' + chan.set.toFixed(0) + '&deg;</td>\n';
        row += '<td>' + (chan.relay ? 'ON' : 'OFF') + '</td>\n';
        row += '</tr>\n';

      }
      $tbody.append(row);
    });
  });
}

$(function() {
  update_chans();
  var id = setInterval(update_chans, 10000);
});

    </script>
<!-- end scripts block -->
{% endblock scripts %}
